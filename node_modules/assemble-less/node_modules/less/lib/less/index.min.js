var path=require("path"),url=require("url"),request,fs=require("fs"),less={version:[1,6,3],Parser:require("./parser").Parser,tree:require("./tree"),render:function(a,b,c){b=b||{},"function"==typeof b&&(c=b,b={});var d,e=new less.Parser(b);return c?void e.parse(a,function(a,d){try{c(a,d&&d.toCSS&&d.toCSS(b))}catch(e){c(e)}}):(d=new(require("events").EventEmitter),process.nextTick(function(){e.parse(a,function(a,c){if(a)return d.emit("error",a);try{d.emit("success",c.toCSS(b))}catch(e){d.emit("error",e)}})}),d)},formatError:function(a,b){b=b||{};var c="",d=a.extract,e=[],f=b.color?require("./lessc_helper").stylize:function(a){return a};if(a.stack&&!a.type)return f(a.stack,"red");if(!a.hasOwnProperty("index")||!d)return a.stack||a.message;if("string"==typeof d[0]&&e.push(f(a.line-1+" "+d[0],"grey")),"string"==typeof d[1]){var g=a.line+" ";d[1]&&(g+=d[1].slice(0,a.column)+f(f(f(d[1][a.column],"bold")+d[1].slice(a.column+1),"red"),"inverse")),e.push(g)}return"string"==typeof d[2]&&e.push(f(a.line+1+" "+d[2],"grey")),e=e.join("\n")+f("","reset")+"\n",c+=f(a.type+"Error: "+a.message,"red"),a.filename&&(c+=f(" in ","red")+a.filename+f(" on line "+a.line+", column "+(a.column+1)+":","grey")),c+="\n"+e,a.callLine&&(c+=f("from ","red")+(a.filename||"")+"/n",c+=f(a.callLine,"grey")+" "+a.callExtract+"/n"),c},writeError:function(a,b){b=b||{},b.silent||console.error(less.formatError(a,b))}};require("./tree/color"),require("./tree/directive"),require("./tree/operation"),require("./tree/dimension"),require("./tree/keyword"),require("./tree/variable"),require("./tree/ruleset"),require("./tree/element"),require("./tree/selector"),require("./tree/quoted"),require("./tree/expression"),require("./tree/rule"),require("./tree/call"),require("./tree/url"),require("./tree/alpha"),require("./tree/import"),require("./tree/mixin"),require("./tree/comment"),require("./tree/anonymous"),require("./tree/value"),require("./tree/javascript"),require("./tree/assignment"),require("./tree/condition"),require("./tree/paren"),require("./tree/media"),require("./tree/unicode-descriptor"),require("./tree/negative"),require("./tree/extend");var isUrlRe=/^(?:https?:)?\/\//i;less.Parser.fileLoader=function(a,b,c,d){function e(b){var d=a.lastIndexOf("/");if(i.relativeUrls&&!/^(?:[a-z-]+:|\/)/.test(a)&&d!=-1){var e=a.slice(0,d+1);i.rootpath=i.rootpath+e}i.currentDirectory=f.replace(/[^\\\/]*$/,""),i.filename=f,c(null,b,f,i)}var f,g,h,i={relativeUrls:d.relativeUrls,entryPath:b.entryPath,rootpath:b.rootpath,rootFilename:b.rootFilename},j=isUrlRe.test(a);if(j||isUrlRe.test(b.currentDirectory)){if(void 0===request)try{request=require("request")}catch(k){request=null}if(!request)return void c({type:"File",message:"optional dependency 'request' required to import over http(s)\n"});var l=j?a:url.resolve(b.currentDirectory,a),m=url.parse(l);request.get({uri:l,strictSSL:!d.insecure},function(a,b,d){return 404===b.statusCode?void c({type:"File",message:"resource '"+l+"' was not found\n"}):(d||console.error("Warning: Empty body (HTTP "+b.statusCode+') returned by "'+l+'"'),a&&c({type:"File",message:"resource '"+l+"' gave this Error:\n  "+a+"\n"}),f=l,g=m.protocol+"//"+m.host+m.pathname.replace(/[^\/]*$/,""),void e(d))})}else{var n=[b.currentDirectory].concat(d.paths);if(n.push("."),d.syncImport){for(var o=0;o<n.length;o++)try{f=path.join(n[o],a),fs.statSync(f);break}catch(k){f=null}if(!f)return void c({type:"File",message:"'"+a+"' wasn't found"});try{h=fs.readFileSync(f,"utf-8"),e(h)}catch(k){c(k)}}else!function p(b){b<n.length?(f=path.join(n[b],a),fs.stat(f,function(a){a?p(b+1):fs.readFile(f,"utf-8",function(a,b){a&&c(a),e(b)})})):c({type:"File",message:"'"+a+"' wasn't found"})}(0)}},require("./env"),require("./functions"),require("./colors"),require("./visitor.js"),require("./import-visitor.js"),require("./extend-visitor.js"),require("./join-selector-visitor.js"),require("./to-css-visitor.js"),require("./source-map-output.js");for(var k in less)less.hasOwnProperty(k)&&(exports[k]=less[k]);