var _=require("lodash");var util=require("util");var chalk=require("chalk");var figures=require("figures");var cliCursor=require("cli-cursor");var Base=require("./base");var observe=require("../utils/events");var utils=require("../utils/readline");var Paginator=require("../utils/paginator");module.exports=Prompt;function Prompt(){Base.apply(this,arguments);if(!this.opt.choices){this.throwParamError("choices")}this.firstRender=true;this.selected=0;var def=this.opt.default;if(_.isNumber(def)&&def>=0&&def<this.opt.choices.realLength){this.selected=def}if(_.isString(def)){this.selected=this.opt.choices.pluck("value").indexOf(def)}this.opt.default=null;this.paginator=new Paginator}util.inherits(Prompt,Base);Prompt.prototype._run=function(cb){this.done=cb;var events=observe(this.rl);events.normalizedUpKey.takeUntil(events.line).forEach(this.onUpKey.bind(this));events.normalizedDownKey.takeUntil(events.line).forEach(this.onDownKey.bind(this));events.numberKey.takeUntil(events.line).forEach(this.onNumberKey.bind(this));events.line.take(1).forEach(this.onSubmit.bind(this));cliCursor.hide();this.render();return this};Prompt.prototype.render=function(){var message=this.getQuestion();if(this.firstRender){message+=chalk.dim("(Use arrow keys)")}if(this.status==="answered"){message+=chalk.cyan(this.opt.choices.getChoice(this.selected).name)}else{var choicesStr=listRender(this.opt.choices,this.selected);message+="\n"+this.paginator.paginate(choicesStr,this.selected)}this.firstRender=false;this.screen.render(message)};Prompt.prototype.onSubmit=function(){var choice=this.opt.choices.getChoice(this.selected);this.status="answered";this.render();this.screen.done();cliCursor.show();this.done(choice.value)};Prompt.prototype.onUpKey=function(){var len=this.opt.choices.realLength;this.selected=this.selected>0?this.selected-1:len-1;this.render()};Prompt.prototype.onDownKey=function(){var len=this.opt.choices.realLength;this.selected=this.selected<len-1?this.selected+1:0;this.render()};Prompt.prototype.onNumberKey=function(input){if(input<=this.opt.choices.realLength){this.selected=input-1}this.render()};function listRender(choices,pointer){var output="";var separatorOffset=0;choices.forEach(function(choice,i){if(choice.type==="separator"){separatorOffset++;output+="  "+choice+"\n";return}var isSelected=i-separatorOffset===pointer;var line=(isSelected?figures.pointer+" ":"  ")+choice.name;if(isSelected){line=chalk.cyan(line)}output+=line+" \n"});return output.replace(/\n$/,"")}