var _=require("lodash");var util=require("util");var chalk=require("chalk");var Base=require("./base");var observe=require("../utils/events");function mask(input){input=String(input);if(input.length===0){return""}return new Array(input.length+1).join("*")}module.exports=Prompt;function Prompt(){return Base.apply(this,arguments)}util.inherits(Prompt,Base);Prompt.prototype._run=function(cb){this.done=cb;var events=observe(this.rl);var submit=events.line.map(this.filterInput.bind(this));var validation=this.handleSubmitEvents(submit);validation.success.forEach(this.onEnd.bind(this));validation.error.forEach(this.onError.bind(this));events.keypress.takeUntil(validation.success).forEach(this.onKeypress.bind(this));this.render();return this};Prompt.prototype.render=function(error){var cursor=0;var message=this.getQuestion();if(this.status==="answered"){message+=chalk.cyan(mask(this.answer))}else{message+=mask(this.rl.line||"")}if(error){message+="\n"+chalk.red(">> ")+error;cursor++}this.screen.render(message,{cursor:cursor})};Prompt.prototype.filterInput=function(input){if(!input){return this.opt.default!=null?this.opt.default:""}return input};Prompt.prototype.onEnd=function(state){this.status="answered";this.answer=state.value;this.render();this.screen.done();this.done(state.value)};Prompt.prototype.onError=function(state){this.render(state.isValid);this.rl.output.unmute()};Prompt.prototype.onKeypress=function(){this.render()};