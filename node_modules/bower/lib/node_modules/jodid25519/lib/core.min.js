"use strict";var crypto=require("crypto");var ns={};function _setbit(n,c,v){var i=c>>4;var a=n[i];a=a+(1<<(c&15))*v;n[i]=a}function _getbit(n,c){return n[c>>4]>>(c&15)&1}function _ZERO(){return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}function _ONE(){return[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}function _BASE(){return[9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}function _bigintcmp(a,b){var c,abs_r,mask;var r=0;for(c=15;c>=0;c--){var x=a[c];var y=b[c];r=r+(x-y)*(1-r*r);mask=r>>31;abs_r=r+mask^mask;r=~~((r<<1)/(abs_r+1))}return r}function _bigintadd(a,b){var r=[];var v;r[0]=(v=a[0]+b[0])&65535;r[1]=(v=(v>>>16)+a[1]+b[1])&65535;r[2]=(v=(v>>>16)+a[2]+b[2])&65535;r[3]=(v=(v>>>16)+a[3]+b[3])&65535;r[4]=(v=(v>>>16)+a[4]+b[4])&65535;r[5]=(v=(v>>>16)+a[5]+b[5])&65535;r[6]=(v=(v>>>16)+a[6]+b[6])&65535;r[7]=(v=(v>>>16)+a[7]+b[7])&65535;r[8]=(v=(v>>>16)+a[8]+b[8])&65535;r[9]=(v=(v>>>16)+a[9]+b[9])&65535;r[10]=(v=(v>>>16)+a[10]+b[10])&65535;r[11]=(v=(v>>>16)+a[11]+b[11])&65535;r[12]=(v=(v>>>16)+a[12]+b[12])&65535;r[13]=(v=(v>>>16)+a[13]+b[13])&65535;r[14]=(v=(v>>>16)+a[14]+b[14])&65535;r[15]=(v>>>16)+a[15]+b[15];return r}function _bigintsub(a,b){var r=[];var v;r[0]=(v=524288+a[0]-b[0])&65535;r[1]=(v=(v>>>16)+524280+a[1]-b[1])&65535;r[2]=(v=(v>>>16)+524280+a[2]-b[2])&65535;r[3]=(v=(v>>>16)+524280+a[3]-b[3])&65535;r[4]=(v=(v>>>16)+524280+a[4]-b[4])&65535;r[5]=(v=(v>>>16)+524280+a[5]-b[5])&65535;r[6]=(v=(v>>>16)+524280+a[6]-b[6])&65535;r[7]=(v=(v>>>16)+524280+a[7]-b[7])&65535;r[8]=(v=(v>>>16)+524280+a[8]-b[8])&65535;r[9]=(v=(v>>>16)+524280+a[9]-b[9])&65535;r[10]=(v=(v>>>16)+524280+a[10]-b[10])&65535;r[11]=(v=(v>>>16)+524280+a[11]-b[11])&65535;r[12]=(v=(v>>>16)+524280+a[12]-b[12])&65535;r[13]=(v=(v>>>16)+524280+a[13]-b[13])&65535;r[14]=(v=(v>>>16)+524280+a[14]-b[14])&65535;r[15]=(v>>>16)-8+a[15]-b[15];return r}function _sqr8h(a7,a6,a5,a4,a3,a2,a1,a0){var r=[];var v;r[0]=(v=a0*a0)&65535;r[1]=(v=(0|v/65536)+2*a0*a1)&65535;r[2]=(v=(0|v/65536)+2*a0*a2+a1*a1)&65535;r[3]=(v=(0|v/65536)+2*a0*a3+2*a1*a2)&65535;r[4]=(v=(0|v/65536)+2*a0*a4+2*a1*a3+a2*a2)&65535;r[5]=(v=(0|v/65536)+2*a0*a5+2*a1*a4+2*a2*a3)&65535;r[6]=(v=(0|v/65536)+2*a0*a6+2*a1*a5+2*a2*a4+a3*a3)&65535;r[7]=(v=(0|v/65536)+2*a0*a7+2*a1*a6+2*a2*a5+2*a3*a4)&65535;r[8]=(v=(0|v/65536)+2*a1*a7+2*a2*a6+2*a3*a5+a4*a4)&65535;r[9]=(v=(0|v/65536)+2*a2*a7+2*a3*a6+2*a4*a5)&65535;r[10]=(v=(0|v/65536)+2*a3*a7+2*a4*a6+a5*a5)&65535;r[11]=(v=(0|v/65536)+2*a4*a7+2*a5*a6)&65535;r[12]=(v=(0|v/65536)+2*a5*a7+a6*a6)&65535;r[13]=(v=(0|v/65536)+2*a6*a7)&65535;r[14]=(v=(0|v/65536)+a7*a7)&65535;r[15]=0|v/65536;return r}function _sqrmodp(a){var x=_sqr8h(a[15],a[14],a[13],a[12],a[11],a[10],a[9],a[8]);var z=_sqr8h(a[7],a[6],a[5],a[4],a[3],a[2],a[1],a[0]);var y=_sqr8h(a[15]+a[7],a[14]+a[6],a[13]+a[5],a[12]+a[4],a[11]+a[3],a[10]+a[2],a[9]+a[1],a[8]+a[0]);var r=[];var v;r[0]=(v=8388608+z[0]+(y[8]-x[8]-z[8]+x[0]-128)*38)&65535;r[1]=(v=8388480+(v>>>16)+z[1]+(y[9]-x[9]-z[9]+x[1])*38)&65535;r[2]=(v=8388480+(v>>>16)+z[2]+(y[10]-x[10]-z[10]+x[2])*38)&65535;r[3]=(v=8388480+(v>>>16)+z[3]+(y[11]-x[11]-z[11]+x[3])*38)&65535;r[4]=(v=8388480+(v>>>16)+z[4]+(y[12]-x[12]-z[12]+x[4])*38)&65535;r[5]=(v=8388480+(v>>>16)+z[5]+(y[13]-x[13]-z[13]+x[5])*38)&65535;r[6]=(v=8388480+(v>>>16)+z[6]+(y[14]-x[14]-z[14]+x[6])*38)&65535;r[7]=(v=8388480+(v>>>16)+z[7]+(y[15]-x[15]-z[15]+x[7])*38)&65535;r[8]=(v=8388480+(v>>>16)+z[8]+y[0]-x[0]-z[0]+x[8]*38)&65535;r[9]=(v=8388480+(v>>>16)+z[9]+y[1]-x[1]-z[1]+x[9]*38)&65535;r[10]=(v=8388480+(v>>>16)+z[10]+y[2]-x[2]-z[2]+x[10]*38)&65535;r[11]=(v=8388480+(v>>>16)+z[11]+y[3]-x[3]-z[3]+x[11]*38)&65535;r[12]=(v=8388480+(v>>>16)+z[12]+y[4]-x[4]-z[4]+x[12]*38)&65535;r[13]=(v=8388480+(v>>>16)+z[13]+y[5]-x[5]-z[5]+x[13]*38)&65535;r[14]=(v=8388480+(v>>>16)+z[14]+y[6]-x[6]-z[6]+x[14]*38)&65535;r[15]=8388480+(v>>>16)+z[15]+y[7]-x[7]-z[7]+x[15]*38;_reduce(r);return r}function _mul8h(a7,a6,a5,a4,a3,a2,a1,a0,b7,b6,b5,b4,b3,b2,b1,b0){var r=[];var v;r[0]=(v=a0*b0)&65535;r[1]=(v=(0|v/65536)+a0*b1+a1*b0)&65535;r[2]=(v=(0|v/65536)+a0*b2+a1*b1+a2*b0)&65535;r[3]=(v=(0|v/65536)+a0*b3+a1*b2+a2*b1+a3*b0)&65535;r[4]=(v=(0|v/65536)+a0*b4+a1*b3+a2*b2+a3*b1+a4*b0)&65535;r[5]=(v=(0|v/65536)+a0*b5+a1*b4+a2*b3+a3*b2+a4*b1+a5*b0)&65535;r[6]=(v=(0|v/65536)+a0*b6+a1*b5+a2*b4+a3*b3+a4*b2+a5*b1+a6*b0)&65535;r[7]=(v=(0|v/65536)+a0*b7+a1*b6+a2*b5+a3*b4+a4*b3+a5*b2+a6*b1+a7*b0)&65535;r[8]=(v=(0|v/65536)+a1*b7+a2*b6+a3*b5+a4*b4+a5*b3+a6*b2+a7*b1)&65535;r[9]=(v=(0|v/65536)+a2*b7+a3*b6+a4*b5+a5*b4+a6*b3+a7*b2)&65535;r[10]=(v=(0|v/65536)+a3*b7+a4*b6+a5*b5+a6*b4+a7*b3)&65535;r[11]=(v=(0|v/65536)+a4*b7+a5*b6+a6*b5+a7*b4)&65535;r[12]=(v=(0|v/65536)+a5*b7+a6*b6+a7*b5)&65535;r[13]=(v=(0|v/65536)+a6*b7+a7*b6)&65535;r[14]=(v=(0|v/65536)+a7*b7)&65535;r[15]=0|v/65536;return r}function _mulmodp(a,b){var x=_mul8h(a[15],a[14],a[13],a[12],a[11],a[10],a[9],a[8],b[15],b[14],b[13],b[12],b[11],b[10],b[9],b[8]);var z=_mul8h(a[7],a[6],a[5],a[4],a[3],a[2],a[1],a[0],b[7],b[6],b[5],b[4],b[3],b[2],b[1],b[0]);var y=_mul8h(a[15]+a[7],a[14]+a[6],a[13]+a[5],a[12]+a[4],a[11]+a[3],a[10]+a[2],a[9]+a[1],a[8]+a[0],b[15]+b[7],b[14]+b[6],b[13]+b[5],b[12]+b[4],b[11]+b[3],b[10]+b[2],b[9]+b[1],b[8]+b[0]);var r=[];var v;r[0]=(v=8388608+z[0]+(y[8]-x[8]-z[8]+x[0]-128)*38)&65535;r[1]=(v=8388480+(v>>>16)+z[1]+(y[9]-x[9]-z[9]+x[1])*38)&65535;r[2]=(v=8388480+(v>>>16)+z[2]+(y[10]-x[10]-z[10]+x[2])*38)&65535;r[3]=(v=8388480+(v>>>16)+z[3]+(y[11]-x[11]-z[11]+x[3])*38)&65535;r[4]=(v=8388480+(v>>>16)+z[4]+(y[12]-x[12]-z[12]+x[4])*38)&65535;r[5]=(v=8388480+(v>>>16)+z[5]+(y[13]-x[13]-z[13]+x[5])*38)&65535;r[6]=(v=8388480+(v>>>16)+z[6]+(y[14]-x[14]-z[14]+x[6])*38)&65535;r[7]=(v=8388480+(v>>>16)+z[7]+(y[15]-x[15]-z[15]+x[7])*38)&65535;r[8]=(v=8388480+(v>>>16)+z[8]+y[0]-x[0]-z[0]+x[8]*38)&65535;r[9]=(v=8388480+(v>>>16)+z[9]+y[1]-x[1]-z[1]+x[9]*38)&65535;r[10]=(v=8388480+(v>>>16)+z[10]+y[2]-x[2]-z[2]+x[10]*38)&65535;r[11]=(v=8388480+(v>>>16)+z[11]+y[3]-x[3]-z[3]+x[11]*38)&65535;r[12]=(v=8388480+(v>>>16)+z[12]+y[4]-x[4]-z[4]+x[12]*38)&65535;r[13]=(v=8388480+(v>>>16)+z[13]+y[5]-x[5]-z[5]+x[13]*38)&65535;r[14]=(v=8388480+(v>>>16)+z[14]+y[6]-x[6]-z[6]+x[14]*38)&65535;r[15]=8388480+(v>>>16)+z[15]+y[7]-x[7]-z[7]+x[15]*38;_reduce(r);return r}function _reduce(arr){var aCopy=arr.slice(0);var choice=[arr,aCopy];var v=arr[15];var a=choice[v<32768&1];a[15]=v&32767;v=(0|v/32768)*19;a[0]=(v+=a[0])&65535;v=v>>>16;a[1]=(v+=a[1])&65535;v=v>>>16;a[2]=(v+=a[2])&65535;v=v>>>16;a[3]=(v+=a[3])&65535;v=v>>>16;a[4]=(v+=a[4])&65535;v=v>>>16;a[5]=(v+=a[5])&65535;v=v>>>16;a[6]=(v+=a[6])&65535;v=v>>>16;a[7]=(v+=a[7])&65535;v=v>>>16;a[8]=(v+=a[8])&65535;v=v>>>16;a[9]=(v+=a[9])&65535;v=v>>>16;a[10]=(v+=a[10])&65535;v=v>>>16;a[11]=(v+=a[11])&65535;v=v>>>16;a[12]=(v+=a[12])&65535;v=v>>>16;a[13]=(v+=a[13])&65535;v=v>>>16;a[14]=(v+=a[14])&65535;v=v>>>16;a[15]+=v}function _addmodp(a,b){var r=[];var v;r[0]=(v=((0|a[15]>>>15)+(0|b[15]>>>15))*19+a[0]+b[0])&65535;r[1]=(v=(v>>>16)+a[1]+b[1])&65535;r[2]=(v=(v>>>16)+a[2]+b[2])&65535;r[3]=(v=(v>>>16)+a[3]+b[3])&65535;r[4]=(v=(v>>>16)+a[4]+b[4])&65535;r[5]=(v=(v>>>16)+a[5]+b[5])&65535;r[6]=(v=(v>>>16)+a[6]+b[6])&65535;r[7]=(v=(v>>>16)+a[7]+b[7])&65535;r[8]=(v=(v>>>16)+a[8]+b[8])&65535;r[9]=(v=(v>>>16)+a[9]+b[9])&65535;r[10]=(v=(v>>>16)+a[10]+b[10])&65535;r[11]=(v=(v>>>16)+a[11]+b[11])&65535;r[12]=(v=(v>>>16)+a[12]+b[12])&65535;r[13]=(v=(v>>>16)+a[13]+b[13])&65535;r[14]=(v=(v>>>16)+a[14]+b[14])&65535;r[15]=(v>>>16)+(a[15]&32767)+(b[15]&32767);return r}function _submodp(a,b){var r=[];var v;r[0]=(v=524288+((0|a[15]>>>15)-(0|b[15]>>>15)-1)*19+a[0]-b[0])&65535;r[1]=(v=(v>>>16)+524280+a[1]-b[1])&65535;r[2]=(v=(v>>>16)+524280+a[2]-b[2])&65535;r[3]=(v=(v>>>16)+524280+a[3]-b[3])&65535;r[4]=(v=(v>>>16)+524280+a[4]-b[4])&65535;r[5]=(v=(v>>>16)+524280+a[5]-b[5])&65535;r[6]=(v=(v>>>16)+524280+a[6]-b[6])&65535;r[7]=(v=(v>>>16)+524280+a[7]-b[7])&65535;r[8]=(v=(v>>>16)+524280+a[8]-b[8])&65535;r[9]=(v=(v>>>16)+524280+a[9]-b[9])&65535;r[10]=(v=(v>>>16)+524280+a[10]-b[10])&65535;r[11]=(v=(v>>>16)+524280+a[11]-b[11])&65535;r[12]=(v=(v>>>16)+524280+a[12]-b[12])&65535;r[13]=(v=(v>>>16)+524280+a[13]-b[13])&65535;r[14]=(v=(v>>>16)+524280+a[14]-b[14])&65535;r[15]=(v>>>16)+32760+(a[15]&32767)-(b[15]&32767);return r}function _invmodp(a){var c=a;var i=250;while(--i){a=_sqrmodp(a);a=_mulmodp(a,c)}a=_sqrmodp(a);a=_sqrmodp(a);a=_mulmodp(a,c);a=_sqrmodp(a);a=_sqrmodp(a);a=_mulmodp(a,c);a=_sqrmodp(a);a=_mulmodp(a,c);return a}function _mulasmall(a){var m=121665;var r=[];var v;r[0]=(v=a[0]*m)&65535;r[1]=(v=(0|v/65536)+a[1]*m)&65535;r[2]=(v=(0|v/65536)+a[2]*m)&65535;r[3]=(v=(0|v/65536)+a[3]*m)&65535;r[4]=(v=(0|v/65536)+a[4]*m)&65535;r[5]=(v=(0|v/65536)+a[5]*m)&65535;r[6]=(v=(0|v/65536)+a[6]*m)&65535;r[7]=(v=(0|v/65536)+a[7]*m)&65535;r[8]=(v=(0|v/65536)+a[8]*m)&65535;r[9]=(v=(0|v/65536)+a[9]*m)&65535;r[10]=(v=(0|v/65536)+a[10]*m)&65535;r[11]=(v=(0|v/65536)+a[11]*m)&65535;r[12]=(v=(0|v/65536)+a[12]*m)&65535;r[13]=(v=(0|v/65536)+a[13]*m)&65535;r[14]=(v=(0|v/65536)+a[14]*m)&65535;r[15]=(0|v/65536)+a[15]*m;_reduce(r);return r}function _dbl(x,z){var x_2,z_2,m,n,o;m=_sqrmodp(_addmodp(x,z));n=_sqrmodp(_submodp(x,z));o=_submodp(m,n);x_2=_mulmodp(n,m);z_2=_mulmodp(_addmodp(_mulasmall(o),m),o);return[x_2,z_2]}function _sum(x,z,x_p,z_p,x_1){var x_3,z_3,p,q;p=_mulmodp(_submodp(x,z),_addmodp(x_p,z_p));q=_mulmodp(_addmodp(x,z),_submodp(x_p,z_p));x_3=_sqrmodp(_addmodp(p,q));z_3=_mulmodp(_sqrmodp(_submodp(p,q)),x_1);return[x_3,z_3]}function _generateKey(curve25519){var buffer=crypto.randomBytes(32);if(curve25519===true){buffer[0]&=248;buffer[31]=buffer[31]&127|64}var result=[];for(var i=0;i<buffer.length;i++){result.push(String.fromCharCode(buffer[i]))}return result.join("")}ns.getbit=_getbit;ns.setbit=_setbit;ns.addmodp=_addmodp;ns.invmodp=_invmodp;ns.mulmodp=_mulmodp;ns.reduce=_reduce;ns.dbl=_dbl;ns.sum=_sum;ns.ZERO=_ZERO;ns.ONE=_ONE;ns.BASE=_BASE;ns.bigintadd=_bigintadd;ns.bigintsub=_bigintsub;ns.bigintcmp=_bigintcmp;ns.mulmodp=_mulmodp;ns.sqrmodp=_sqrmodp;ns.generateKey=_generateKey;module.exports=ns;