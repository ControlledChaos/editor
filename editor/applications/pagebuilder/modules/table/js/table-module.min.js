(function( exports, $ ) {
    var api = sedApp.editor;

    $( function() {

        api.shortcodeUpdate.sed_table = {

            number_columns : function( id , value ){
                var patternId = $('[sed_model_id="' + id + '"]').siblings(".add-item-column-table:first").attr("sed_model_id") ,
                    rows = $('[sed_model_id="' + id + '"]').find(".list-group-tr-rows"),
                    colsLen = $('[sed_model_id="' + id + '"]').find(".list-group-tr-rows:first").children("td").length;

                 api.addModelPattern({
                    newValue        : value  ,
                    oldValue        : colsLen  ,
                    type            : "single"  ,
                    id              : $('[sed_model_id="' + id + '"]').find("thead:first > tr").attr("sed_model_id")  ,
                    patternId       : $('[sed_model_id="' + id + '"]').siblings(".add-item-head-column-table:first").attr("sed_model_id")  ,
                    list            : $('[sed_model_id="' + id + '"]').find(".list-group-hr-rows > th")  ,
                    attrs           : [],
                    shortcode_name  : "sed_tr_table"  ,
                    refresh         : false ,
                    //group           :   ,
                  //max             :   ,
                    min             : 1  ,
                    //onCreate        : function(){} ,
                    //onAddPatten     : function(){} ,
                 });

                 api.addModelPattern({
                    newValue        : value  ,
                    oldValue        : colsLen  ,
                    type            : "multiple"  ,
                    id              : id  ,
                    patternId       : patternId  ,
                    attrs           : [],
                    shortcode_name  : "sed_tr_table"  ,
                    refresh         : false ,
                    group           : rows ,
                    //list            : ".list-group-tr-rows:first" ,
                    memberG         : ">td" ,
                    max             : 12  ,
                    min             : 1
                 });

                 api.Events.trigger( "syncModuleTmpl" , id , "sed_table" );
            },

            number_rows : function( id , value ){
                var patternId = $('[sed_model_id="' + id + '"]').siblings(".add-item-row-table:first").attr("sed_model_id") ,
                    rows = $('[sed_model_id="' + id + '"]').find(".list-group-rows:first > tr") ,
                    rowsLen = rows.length ,
                    colsLen = $('[sed_model_id="' + id + '"]').find(".list-group-tr-rows:first").children("td").length;

                 api.addModelPattern({
                    newValue        : value  ,
                    oldValue        : rowsLen  ,
                    type            : "single"  ,
                    id              : $('[sed_model_id="' + id + '"]').find("tbody:first").attr("sed_model_id")  ,
                    patternId       : patternId  ,
                    list            : rows  ,
                    attrs           : [],
                    shortcode_name  : "sed_tbody_table"  ,
                    refresh         : false ,
                    //group           :   ,
                  //max             :   ,
                    min             : 1  ,
                    onAfterSingleCreate : function(){
                         if(colsLen > 0 && value > rowsLen ){
                             var children = api.contentBuilder.getShortcodeChildren( $('[sed_model_id="' + id + '"]').find("tbody:first").attr("sed_model_id") ) ,
                                 pId = children[children.length-1].id;
                             api.addModelPattern({
                                newValue        : colsLen  ,
                                oldValue        : 0  ,
                                type            : "single"  ,
                                id              : pId , //$('[sed_model_id="' + id + '"]').find(".list-group-tr-rows:last").attr("sed_model_id")  ,
                                patternId       : $('[sed_model_id="' + id + '"]').siblings(".add-item-column-table:first").attr("sed_model_id")  ,
                                //list            : $('[sed_model_id="' + id + '"]').find(".list-group-hr-rows > th")  ,
                                attrs           : [],
                                shortcode_name  : "sed_tr_table"  ,
                                refresh         : false ,
                                //group           :   ,
                              //max             :   ,
                                min             : 1  ,
                                //onCreate        : function(){} ,
                                //onAddPatten     : function(){} ,
                             });
                         }
                    }
                    //onCreate        : function(){} ,
                    //onAddPatten     : function(){} ,
                 });

                 api.Events.trigger( "syncModuleTmpl" , id , "sed_table" );

            }

        };

    });


}(sedApp, jQuery));