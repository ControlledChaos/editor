(function( exports, $ ) {

    var api = sedApp.editor ;

    api.AppPreset = api.Class.extend({

        initialize: function( params , options ){
            var self = this;

            $.extend( this, options || {} );

            api.preview.bind( 'sedLoadNewPreset', function( presetPattern ) {
                var newPattern = api.sedShortcode.clone( presetPattern );
                    elementId = api.currentSedElementId ;

                var mainShortcode = api.contentBuilder.getShortcode( elementId ) ,
                    parentId = mainShortcode.parent_id;

                //create new pattern
                newPattern = api.pageBuilder.loadPattern( newPattern , parentId );

                //set helper id for add shortcode pattern id
                newPattern = api.pageBuilder.setHelperShortcodes( newPattern , mainShortcode.tag , "tag" );

                //shortcode pattern filter
                newPattern = api.pageBuilder.shortcodesPatternFilter( newPattern );

                //replace new pattern with old shortcodes models
                api.sedShortcode.replaceModel( elementId , newPattern );

                //send data to top iframe for save ready
                api.contentBuilder.sendData( "theme" );

                //apply design editor css in preview
                api.pageBuilder.syncStyleEditorPreview( newPattern );
                
                //Current Element Id refresh
                api.currentSedElementId = newPattern[0].id;

                //refresh module in @DOM
                api.contentBuilder.refreshModule( parentId );

                api.preview.send( 'changeCurrentElementByChangePreset', {
                    elementId       : newPattern[0].id ,
                    shortcode_name  : newPattern[0].tag ,
                    attrs           : newPattern[0].attrs
                });


                //api.selectPlugin.select( $( '[sed_model_id="' + newPattern[0].id + '"]' ) , false );
            });

            api.preview.bind( 'sedSetAsDefaultPreset', function( obj ) {
                api.defaultPatterns[obj.name] = obj.content;
            });



            //this.ready();
        },

    });


    $( function() {

        api.appPreset = new api.AppPreset({});

    });

}(sedApp, jQuery));