(function( exports, $ ){
    
    var api = sedApp.editor;

    $( function() { 

        api.colorSchemeSettings = window._sedColorSchemeSettings;

        api( 'sed_site_custom_css', function( value ) {
            value.bind( function( to ) {

                //sanitize string => remove html tags
                to = to.replace(/(<([^>]+)>)/ig,"");

                $("#sed_site_custom_css_code").html( to );

            });
        });

        /*api( 'sed_switch_setting', function( value ) {
            value.bind( function( to ) {

               // alert( to );

            });
        });

        api( 'sed_toggle_setting', function( value ) {
            value.bind( function( to ) {

                //alert( to );

            });
        });*/

        var _changeSiteColorSchema = function(){

            var _varsTpl = {};

            $.each( api.colorSchemeSettings.customize , function( _key , _settingId ){
                _varsTpl[_key] = api( _settingId )();
            });

            var template = api.template("tmpl-sed-color-scheme"),
                html = template( _varsTpl );

            $("#sed_color_scheme_css_code").html( html );

        };

        var _changeSiteColorSchemaBySkin = function( skin ){

            if( skin == "default" || _.isUndefined( api.colorSchemeSettings.skin[skin] ) ){
                $("#sed_color_scheme_css_code").html( "" );
            }else{

                var _varsTpl = {};

                $i = 0;
                $.each( api.colorSchemeSettings.customize , function( _key , _settingId ){
                    _varsTpl[_key] = api.colorSchemeSettings.skin[skin][$i];
                    $i++;
                });

                var template = api.template("tmpl-sed-color-scheme"),
                    html = template( _varsTpl );

                $("#sed_color_scheme_css_code").html( html );

            }

        };

        api( 'sed_color_scheme_type', function( value ) {
            value.bind( function( to ) {

                if( to == "customize" ){

                    _changeSiteColorSchema();

                }else{

                    _changeSiteColorSchemaBySkin( api( 'sed_color_scheme_skin' )() );

                }

            });
        });

        api( 'sed_color_scheme_skin', function( value ) {
            value.bind( function( to ) { 

                if( api( 'sed_color_scheme_type' )() == "skin" ){

                    _changeSiteColorSchemaBySkin( to );

                }

            });
        });

        $.each( api.colorSchemeSettings.customize , function( key , settingId ){

            api( settingId , function( value ) {

                value.bind( function( to ) {

                    var _varsTpl = {};

                    $.each( api.colorSchemeSettings.customize , function( _key , _settingId ){
                        _varsTpl[_key] = api( _settingId )();
                    });

                    var template = api.template("tmpl-sed-color-scheme"),
                        html = template( _varsTpl );

                    $("#sed_color_scheme_css_code").html( html );

                });

            });

        });
        
    });


})( sedApp, jQuery );