(function( exports, $ ) {
    var api = sedApp.editor;

    $( function() {


      $(".module.module-accordion h3 .sed-title").livequery(function(){
            $(this).keydown(function(e){
                 if( event.which == 32 ){
                    e.stopPropagation();
                 }
            });
        });

        api.shortcodeUpdate.sed_accordion = {

            number_items : function( id , value ){
                var patternId = $('[sed_model_id="' + id + '"]').siblings(".add-item-accordion:first").attr("sed_model_id") ,
                    acds = $('[sed_model_id="' + id + '"]').find("h3") ,
                    acdsLen = acds.length;

                 api.addModelPattern({
                    newValue        : value  ,
                    oldValue        : acdsLen  ,
                    type            : "single"  ,
                    id              : id  ,
                    patternId       : patternId  ,
                    list            : acds  ,
                    attrs           : [],
                    shortcode_name  : "sed_accordion"  ,
                    refresh         : true ,
                    //group           :   ,
                    //max             :   ,
                    min             : 1  ,
                    onRemove        : function( hEl ){
                        api.remove( hEl.next().attr("sed_model_id") );
                    },
                    //onCreate        : function(){} ,
                    //onAddPatten     : function(){} ,
                 });
            }

        };

        
        api.shortcodeCreate.sed_accordion = function( id , param ){

            var js_settings_str = "",key_setting='';
            $.each( param.context , function( key , value ){
            	if( key.substr(0,7) == 'setting' ){
                    key_setting = key.substr(8);             
                    js_settings_str += "data-" + key_setting.replace(/\_/gi , "-") + '="' + value + '" ';   		
            	}
            });
            param.context.item_settings = js_settings_str;
            return param;
        };


    });


}(sedApp, jQuery));