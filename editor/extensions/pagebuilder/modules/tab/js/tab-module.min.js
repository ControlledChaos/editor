(function( exports, $ ) {
    var api = sedApp.editor;

    $( function() {

        api.shortcodeUpdate.sed_tabs = {

            number_tabs : function( id , value ){
                var patternId_1 = $( '[sed_model_id="' + id + '"]' ).siblings(".add-item-tab-pattern").attr("sed_model_id") ,
                    tabs = $('[sed_model_id="' + id + '"]').find(".nav-tabs > li") ,
                    tabsLen = tabs.length , attrs = [];


                var patternId_2 = $( '[sed_model_id="' + id + '"]' ).siblings(".add-item-content-tab-pattern").attr("sed_model_id") ,
                    cots = $('[sed_model_id="' + id + '"]').find(".tab-pane") ,
                    cotsLen = cots.length;

                 api.addModelPattern({
                    newValue        : value  ,
                    oldValue        : cotsLen  ,
                    type            : "single"  ,
                    id              : $('[sed_model_id="' + id + '"]').find(".tab-content:first").attr("sed_model_id") ,
                    patternId       : patternId_2  ,
                    list            : cots  ,
                    attrs           : [],
                    shortcode_name  : "sed_content_tabs"  ,
                    refresh         : false ,
                    //group           :   ,
                    max             : 18  ,
                    min             : 1  ,
                    onAfterSingleCreate : function(){
                       var children = api.contentBuilder.getShortcodeChildren( id ) ,
                           sedContentTabs = _.find( children , function(shortcode){
                              return !_.isUndefined(shortcode.attrs) && !_.isUndefined(shortcode.attrs.sed_tabs_content_container) && shortcode.attrs.sed_tabs_content_container;
                           }) ,
                           cChildren = api.contentBuilder.getShortcodeChildren( sedContentTabs.id ) ,
                           lastTabContentId = cChildren[cChildren.length-1].id;
                           attrs.push( [{href : "#" + lastTabContentId}] );

                    }
                    //onCreate        : function(){} ,
                    //onAddPatten     : function(){} ,
                 });



                 api.addModelPattern({
                    newValue        : value  ,
                    oldValue        : tabsLen  ,
                    type            : "single"  ,
                    id              : $('[sed_model_id="' + id + '"]').find(".nav-tabs:first").attr("sed_model_id")  ,
                    patternId       : patternId_1  ,
                    list            : tabs  ,
                    attrs           : attrs,
                    shortcode_name  : "sed_title_tabs"  , 
                    refresh         : false ,
                    //group           :   ,
                    max             : 18  ,
                    min             : 1  ,
                    //onCreate        : function(){} ,
                    //onAddPatten     : function(){} ,
                 });

                 api.Events.trigger( "syncModuleTmpl" , id , "sed_tabs" );

            }

        };

    });


}(sedApp, jQuery));