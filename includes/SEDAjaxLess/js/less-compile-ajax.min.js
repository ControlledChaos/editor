jQuery(document).ready(function($) {
    var api = sedApp.editor;

    $( "#sed-compiled-less" ).click(function(e) {
        e.preventDefault();
        var $parent = $(this).parent('#sed-module-not-compiled'),
        values  = [];
        $parent.find('.less-file-item').each(function(index, el) {
            var name  = $(this).attr('name'),
                value = $(this).val(),
                src_rel = $(this).data('relSrc');
                values.push( [ name , value , src_rel ] );
        });

        var AjaxLessCompile = new api.Ajax({
            data : {
                action        : 'compile_less',
                filedata      : { compile_files : values , save_compile : true },
                nonce         : api.addOnSettings.SEDLess.nonce.compile ,
                sed_page_ajax : 'sed_ajax_compiler'
            },
            loadingType : "small" ,
            success : function(){

                var response = this.response.data.output;

                if( !$.isEmptyObject( response.getErrors ) ){
                    $.each( response.getErrors , function( key , value ){
                        console.log( "=================== Error " + key + " ===================" );
                        console.log( value );
                    });
                }

                if( !$.isEmptyObject( response.styles ) ){
                    $.each( response.styles , function( index , value ){
                        var tag = '<link href="'+ value + '" rel="stylesheet">';
                        $("body").append( tag );
                        console.log( "SED add stylesheet : " + value );
                    });
                }

                $parent.hide();
                console.log( response );

            },

            error : function(){

            }

        }, {
            container   : "#sed-module-not-compiled .module-not-compiled-title" ,
            repeatRequest : false
        });

    });

    $( "#sed-close-compiled-less" ).click(function(event) {
        $parent = $(this).parent('#sed-module-not-compiled');
        $parent.hide();
    });
    
});
