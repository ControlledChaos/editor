(function( exports, $ ) {
    var api = sedApp.editor;

    $( function() {

        var _goToByScroll = function ( targetOffset ) {
            $('html, body').animate({scrollTop: targetOffset}, 2000 );
        };


        $('.woo-products-tabs').livequery(function(){

            var id_box = $(this).attr("id") ,
                _ajaxLoadedTabs = [] ,
                activatedTabs = [ $('#' + id_box + ' a:first').attr("href") ];

            $(this).find('a[data-toggle="tab"]').click(function (e) {
            	  e.preventDefault();
            	  $(this).tab('show');

                  var cId = $(this).attr("href") ;

                  if( $.inArray( cId , _ajaxLoadedTabs ) == -1 && !$(this).hasClass("first-tab") ){
                      var request = $.ajax({
                          type: "POST",
                          url: window._sedTabAjaxOptions.ajax_url,
                          data:
                          {
                              action        : 'tab_product_loader',
                              nonce         :  window._sedTabAjaxOptions.nonce ,
                              sed_page_ajax :  'product_in_tab_loader' ,
                              atts          :   $(this).data("query"),
                              product_by    :   $(this).data("productBy"),
                              category      :   $(this).data("category")
                          },
                          beforeSend: function()
                          {
                              $(cId).find(".loading.tab-ajax-loading").show();
                              //$('.icon-library-loading' , '#site-editor-icon-library').show();
                          },
                          error: function()
                          {
                              alert('Couldn\'t add the font because the server didn’t respond.<br/>Please reload the page, then try again');
                          },
                      });

                      request.done(function(response)
                      {
                          //$('.icon-library-loading' , '#site-editor-icon-library').hide();

                          if( response.success === true){

                              var products = response.data;
                              $(cId).html( products );

                          }else{
                              alert(response.data.invalid);
                              $(cId).find(".loading.tab-ajax-loading").hide();
                          }

                      });

                      _ajaxLoadedTabs.push( cId );
                  }

            });



            $('#' + id_box + ' a[data-toggle="tab"]').on('shown.bs.tab', function (e) {

                var cId = $(this).attr("href");
                //if( $.inArray( cId , activatedTabs ) == -1 ){
                    $(cId).find(".sed-row-pb > .sed-pb-module-container").trigger("sedFirstTimeActivatedTabs" , [$(this)]);
                    //activatedTabs.push( cId );
                //}

            });


            $(this).find(".btn-elevator").each(function(){
                //e.preventDefault();
                var rowContainer = $(this).closest(".sed-row-pb"),
                    existPrevNext = false;

                if( $(this).hasClass("fa-angle-up") && rowContainer.prev().length > 0 && rowContainer.prev().hasClass("sed-row-pb") ){
                    $(this).attr("href" , "#" + rowContainer.prev().attr("id") );
                    existPrevNext = true;
                }else if( $(this).hasClass("fa-angle-down") && rowContainer.next().length > 0 && rowContainer.next().hasClass("sed-row-pb") ){
                    $(this).attr("href" , "#" + rowContainer.next().attr("id") );
                    existPrevNext = true;
                }

                if( existPrevNext === true  ){
                    $(this).click(function(e){
                        e.preventDefault();
                        var target = $( $(this).attr("href") );
                        var targetOffsetTop = target.offset().top - 37;

                        if( $('#wpadminbar').length > 0 ) {
                            targetOffsetTop -= $('#wpadminbar').outerHeight();
                        }

                        _goToByScroll(targetOffsetTop);
                    });
                }

            });

        });


    });


}(sedApp, jQuery));