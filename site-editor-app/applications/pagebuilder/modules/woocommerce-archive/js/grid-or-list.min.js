jQuery( document ).ready( function ( $ ) {

    $('.woocommerce-archive').livequery(function(){
        var $element =$(this),
            gridOrList    =  $element.find(".grid-or-list") ,
            pfInstockLabel=  $element.find(".sed_filter_instock.sed_filter_woocommerce > label > input") ,
            gridListItem  =  gridOrList.find("> a") ,
            gridVeiw      =  gridOrList.find(".grid-veiw"),
            listVeiw      =  gridOrList.find(".list-veiw");

        gridVeiw.click(function(){
            var productsContainer =  $element.find(".sed-products-container.products");
            if(productsContainer.hasClass("sed-products-ct-list")){
                productsContainer.removeClass("sed-products-ct-list");
            }
            gridListItem.removeClass("active");
            $(this).addClass("active");

        });
        listVeiw.click(function(){

            var productsContainer =  $element.find(".sed-products-container.products");

            if(!productsContainer.hasClass("sed-products-ct-list")){
                productsContainer.addClass("sed-products-ct-list");
            }
            gridListItem.removeClass("active");
            $(this).addClass("active");

        });


        pfInstockLabel.on( "click" ,function(){

            var el_label =$(this).parent();

            if(el_label.hasClass("active")){
                el_label.removeClass("active");
            }else{
                el_label.addClass("active");
            }

        });

    });


    if( $("body").hasClass("sed_mobile_version") ){

        var __addCustomScrollbar = function( elm ){
            elm.mCustomScrollbar({
                //theme:"dark" ,
                autoHideScrollbar:true ,
                documentTouchScroll : true,
                advanced:{
                    updateOnBrowserResize:true, /*update scrollbars on browser resize (for layouts based on percentages): boolean*/
                    updateOnContentResize:true,
                },
            });
        };

        $("#prdctfltr_woocommerce").livequery(function(){
            var $tabs = $('<div class="prdctfltr-tab"><ul role="tablist" class="tab-container nav nav-tabs"></ul></div>').prependTo( $(this).find(".prdctfltr_filter_wrapper") ),
                $num = 0;

            $(this).addClass("sed-mobile-products-filters");

            $(this).find(".prdctfltr_filter_inner").addClass("tab-content");

            $(this).find(".prdctfltr_filter_inner > .prdctfltr_filter").each(function(){

                if( $(this).hasClass("prdctfltr_range") && $(this).hasClass("prdctfltr_price") ){
                    return ;
                }

                $num++;
                var $id = "prdctfltr_filter_box_" + $num,
                    $text = $(this).find(".prdctfltr_widget_title").text(),
                    $html;

                if( $num == 1 ){
                    $html = '<li role="presentation" class="active"><a href="#'+$id+'" role="tab" data-toggle="tab">'+ $text +'</a></li>';
                }else{
                    $html = '<li role="presentation"><a href="#'+$id+'" role="tab" data-toggle="tab">'+ $text +'</a></li>';
                }

                $(this).attr( "id" , $id );
                $(this).attr( "role" , "tabpanel" );

                if( $num == 1 ){
                    $(this).addClass("tab-pane fade in active");
                }else{
                    $(this).addClass("tab-pane fade");
                }

                $( $html ).appendTo( $tabs.find(">.tab-container") );

            });

            if( $(this).find(".prdctfltr_buttons > .prdctfltr_reset").length == 0 ){
                $(this).find(".prdctfltr_buttons").addClass("not-exist-reset-btn");
                $(".sed-woo-filter-by-toggle").removeClass("active");
            }else{
                $(".sed-woo-filter-by-toggle").addClass("active");
            }

            $(this).parents(".prdctfltr-widget:first").addClass("sed-mobile-products-filters-container");

            $('<div class="sed-prdctfltr-heading"><span>'+ window._Ii8WooArchive.productFilter +'</span></div>').prependTo( $(this) );

            var extrah = $(this).find(".sed-prdctfltr-heading").height() + $(this).find(".prdctfltr_buttons").height();

            $(this).find(".prdctfltr_filter_inner > .prdctfltr_filter.tab-pane .prdctfltr_checkboxes").height( $(window).height() - extrah );

            $(this).find(".prdctfltr-tab").height( $(window).height() - extrah );

            $(this).find(".prdctfltr_filter_inner > .prdctfltr_filter.tab-pane .prdctfltr_checkboxes").each(function(){
                __addCustomScrollbar( $(this) );
            });

            __addCustomScrollbar( $(this).find(".prdctfltr-tab") );

        });

        $(".sed-woo-filter-by-toggle").livequery(function(){
            $(this).click(function(){
                $("#prdctfltr_woocommerce").parents(".sed-mobile-products-filters-container:first").addClass("sed-prdctfltr-fixed");
                $("html").css("overflow-y" , "hidden");
            });
        });

        $("#prdctfltr_woocommerce .sed-prdctfltr-heading,#prdctfltr_woocommerce .prdctfltr_woocommerce_filter_submit,#prdctfltr_woocommerce .prdctfltr_reset").livequery(function(){
            $(this).click(function(){
                $("#prdctfltr_woocommerce").parents(".sed-mobile-products-filters-container:first").removeClass("sed-prdctfltr-fixed");

                if( $(this).hasClass("prdctfltr_woocommerce_filter_submit") ){
                    $(".sed-woo-filter-by-toggle").addClass("active");
                }else if( $(this).hasClass("prdctfltr_reset") ){
                    $(".sed-woo-filter-by-toggle").removeClass("active");
                }
                $("html").css("overflow-y" , "scroll");
            });
        });


        $(document).click(function (event) {
            var clickover = $(event.target);   //_opened === true &&
            if ( clickover.parents("#prdctfltr_woocommerce").length == 0 && clickover.attr("id") != "prdctfltr_woocommerce" &&  clickover.parents(".sed-woo-filter-by-toggle").length == 0 &&  !clickover.hasClass("sed-woo-filter-by-toggle") ) {
                $("#prdctfltr_woocommerce").parents(".sed-mobile-products-filters-container:first").removeClass("sed-prdctfltr-fixed");
            }
        });

    }

});

